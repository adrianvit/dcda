<!DOCTYPE html>
<html>
<head>
<title>Package Management</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link
	href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css"
	rel="stylesheet">
<script src="http://ajax.aspnetcdn.com/ajax/jquery/jquery-1.9.0.js"></script>
<script
	src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/knockout/knockout-2.2.1.js"></script>
<script src="products.js"></script>
<script src="objstorage.js"></script>


</head>
<body>
  
<div class="container">
	
  	<br><br>
  	<div class="span5 offset4"><h2>List of Products</h2></div>
  	<br><br><br><br>
	<table class="table table-hover" >
		<thead>
			<tr>
				<th>Product ID</th>
				<th>Description</th>
				<th>Price</th>
				<th>Quantity</th>
				<th>Order</th>
			</tr>
		</thead>
		<tbody data-bind="foreach: pagedRows">
		<tr>
			<td data-bind="text: product_id"></td>
			<td data-bind="text: description"></td>
			<td data-bind="text: price"></td>
			<td data-bind="text: quantity"></td>
			<td><button data-bind="click: $root.addToCart">Add to Cart</button></td>
			
		</tr>
		</tbody>
	</table>
	
<div>	
<ul class="pager">
	<li><a href="#" data-bind="click: previousPage, visible: pageIndex() > 0">Previous</a></li>
	<li><a href="#" data-bind="click: nextPage, visible: pageIndex() < 10">Next</a></li>
</ul>
</div>

<div>
	<button data-bind="click: $root.goToCart">My Shopping Cart</button>
</div>
<br><br>
<div>
	<input data-bind="value: searchName"></input>
	<button data-bind="click: $root.searchProduct">Search product</button>
</div>
<div>
<table class="table table-hover" data-bind="visible: $root.searchProducts().length > 0">
		<thead>
			<tr>
				<th>Product ID</th>
				<th>Description</th>
				<th>Price</th>
				<th>Quantity</th>
				<th>Order</th>
			</tr>
		</thead>
		<tbody data-bind="foreach: searchProducts">
		<tr>
			<td data-bind="text: product_id"></td>
			<td data-bind="text: description"></td>
			<td data-bind="text: price"></td>
			<td data-bind="text: quantity"></td>
			<td><button data-bind="click: $root.addToCart">Add to Cart</button></td>
		</tr>
		</tbody>
	</table>
</div>
</div>
	<script type="text/javascript">

			function AppViewModel(searchName) {
				var self = this;
				
				self.searchName = searchName;
			    self.products = ko.observableArray([]);
			    self.searchProducts = ko.observableArray([]);
			    self.decoy = new Product("11","teeeef", "34", "44");
    			self.shoppingList = ko.observableArray([self.decoy]);
    			self.shoppingList.remove(self.decoy);
				
				self.addToCart = function(product){
        			self.shoppingList.push(product);
        			console.log('product'+ self.shoppingList);
   					};
    			self.goToCart = function(){
					  localStorage.setObj('products',self.shoppingList);
					  console.log('shopping list' + self.shoppingList);
					  window.location.replace("http://localhost:18080/webapp/mycart.html");
    			};
				self.searchProduct = function(){
					 $.getJSON("http://localhost:18080/local/search?key=" + self.searchName + "&ttl=2", function(allData) {
			        var mappedProducts = $.map(allData, function(item) { return new Product(item.productid, item.description, item.price, item.quantity) });
			        self.searchProducts(mappedProducts);
			    }); 
				};
			    self.pageSize = ko.observable(3);
        		self.pageIndex = ko.observable(0);
        		self.previousPage = function() {
            		self.pageIndex(self.pageIndex() - 1);
        		};
        		self.nextPage = function() {
            		self.pageIndex(self.pageIndex() + 1);
    			};

    			self.pagedRows = ko.dependentObservable(function() {
       				 	var size = this.pageSize();
        				var start = this.pageIndex() * size;
        				return self.products.slice(start, start + size);
    				}, self);
    			
			    $.getJSON("http://localhost:18080/local/products/", function(allData) {
			        var mappedProducts = $.map(allData, function(item) { return new Product(item.productid, item.description, item.price, item.quantity) });
			        self.products(mappedProducts);
			    }); 
			};
			
			ko.applyBindings(new AppViewModel());
	</script>
</body>
</html>